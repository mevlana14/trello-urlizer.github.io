<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feedback References</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Helvetica Neue', Arial, sans-serif;
            padding: 8px 12px;
            margin: 0;
            background: #fff;
            font-size: 13px;
            color: #172b4d;
        }
        .reference {
            font-family: monospace;
            background: #f4f5f7;
            padding: 6px 10px;
            border-radius: 3px;
            margin-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .original {
            color: #5e6c84;
        }
        .arrow {
            color: #0079bf;
        }
        .transformed {
            color: #172b4d;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <div id="content"></div>

    <script src="https://p.trellocdn.com/power-up.min.js"></script>
    <script src="./js/feedback-replacer.js"></script>
    <script>
        var t = window.TrelloPowerUp.iframe();
        var content = document.getElementById('content');

        t.card('name', 'desc')
            .then(function(card) {
                var allPatterns = [];

                // Collect patterns from card name
                if (card.name) {
                    var namePatterns = FeedbackReplacer.detectPatterns(card.name);
                    namePatterns.forEach(function(p) {
                        if (!p.originalText.toLowerCase().includes('mevlana')) {
                            allPatterns.push(p);
                        }
                    });
                }

                // Collect patterns from card description
                if (card.desc) {
                    var descPatterns = FeedbackReplacer.detectPatterns(card.desc);
                    descPatterns.forEach(function(p) {
                        if (!p.originalText.toLowerCase().includes('mevlana')) {
                            allPatterns.push(p);
                        }
                    });
                }

                // Display each pattern with its transformation
                allPatterns.forEach(function(p) {
                    var div = document.createElement('div');
                    div.className = 'reference';
                    div.innerHTML =
                        '<span class="original">' + escapeHtml(p.originalText) + '</span>' +
                        '<span class="arrow">â†’</span>' +
                        '<span class="transformed">feedback: mevlana: ' + p.numericId + '</span>';
                    content.appendChild(div);
                });
            });

        function escapeHtml(text) {
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
